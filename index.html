<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>W1se Dark AI Chat</title>
<style>
body { background-color:#000; color:white; font-family:Arial,sans-serif; margin:0; text-align:center; }
header { padding:20px; background:#111; font-size:1.5em; font-weight:bold; }
a { color:#ff0000; text-decoration:none; }
input, button, textarea { padding:10px; margin:5px; border:none; border-radius:5px; }
input, textarea { width:90%; max-width:400px; }
button { background-color:#ff0000; color:white; cursor:pointer; }
#chat { max-width:600px; margin:auto; text-align:left; height:300px; overflow-y:auto; }
.message { background:#111; padding:10px; margin:10px 0; border-radius:8px; animation:fadeIn 0.3s; }
.user { color:#ff4444; }
.bot { color:#44ff44; }
@keyframes fadeIn { from {opacity:0;} to {opacity:1;} }
#loginForm, #chatContainer { display:none; }
</style>
</head>
<body>

<header>W1se Dark AI — <a href="https://instagram.com/w1se.prince_" target="_blank">@w1se.prince_</a></header>

<div id="loginForm">
<h3>Вход / Регистрация</h3>
<input type="text" id="username" placeholder="Логин"><br>
<input type="password" id="password" placeholder="Пароль"><br>
<button onclick="register()">Регистрация</button>
<button onclick="login()">Вход</button>
<div id="loginMsg" style="color:#ff4444; margin-top:10px;"></div>
</div>

<div id="chatContainer">
<h3>Чат с ИИ</h3>
<div id="chat"></div>
<textarea id="userInput" placeholder="Напиши сообщение..."></textarea><br>
<button onclick="sendMessage()">Отправить</button>
<button onclick="window.open('https://deepdark.ai','_blank')">DeepDark AI</button>
</div>

<script>
// Твой реальный API ключ OpenRouter
const OPENROUTER_API_KEY = "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"; 
const MODEL = "deepseek/deepseek-r1:free"; 

let currentUser = null;

function showLogin() {
    document.getElementById('loginForm').style.display = 'block';
    document.getElementById('chatContainer').style.display = 'none';
}

function showChat() {
    document.getElementById('loginForm').style.display = 'none';
    document.getElementById('chatContainer').style.display = 'block';
    loadChatHistory();
}

function register() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    if(!username || !password) return alert('Введите логин и пароль!');
    if(localStorage.getItem('user_'+username)) {
        document.getElementById('loginMsg').innerText = "Пользователь уже существует!";
        return;
    }
    localStorage.setItem('user_'+username, JSON.stringify({password, history: []}));
    document.getElementById('loginMsg').innerText = "Регистрация успешна! Войдите.";
}

function login() {
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();
    const userData = JSON.parse(localStorage.getItem('user_'+username));
    if(!userData || userData.password !== password) {
        document.getElementById('loginMsg').innerText = "Неверный логин или пароль!";
        return;
    }
    currentUser = username;
    showChat();
}

function loadChatHistory() {
    const userData = JSON.parse(localStorage.getItem('user_'+currentUser));
    const chatDiv = document.getElementById('chat');
    chatDiv.innerHTML = '';
    if(userData && userData.history) {
        userData.history.forEach(msg => {
            chatDiv.innerHTML += `<div class="message ${msg.role}"><b>${msg.role==="user"?"Ты":"ИИ"}:</b> ${msg.content}</div>`;
        });
    }
    chatDiv.scrollTop = chatDiv.scrollHeight;
}

async function sendMessage() {
    const userMessage = document.getElementById('userInput').value.trim();
    if(!userMessage) return;
    document.getElementById('chat').innerHTML += `<div class="message user"><b>Ты:</b> ${userMessage}</div>`;
    document.getElementById('userInput').value = '';

    saveMessage(currentUser, 'user', userMessage);

    try {
        const response = await fetch('https://openrouter.ai/api/v1/chat/completions', {
            method: 'POST',
            headers: { 'Authorization':'Bearer '+OPENROUTER_API_KEY, 'Content-Type':'application/json' },
            body: JSON.stringify({
                model: MODEL,
                messages: [{ role:'user', content: userMessage }],
                temperature:0.7,
                max_tokens:512
            })
        });
        const data = await response.json();
        const reply = data.choices?.[0]?.message?.content || "Ошибка API";
        document.getElementById('chat').innerHTML += `<div class="message bot"><b>ИИ:</b> ${reply}</div>`;
        saveMessage(currentUser, 'bot', reply);
        document.getElementById('chat').scrollTop = document.getElementById('chat').scrollHeight;
    } catch(err) {
        document.getElementById('chat').innerHTML += `<div class="message bot"><b>Ошибка:</b> ${err}</div>`;
    }
}

function saveMessage(user, role, content) {
    const userData = JSON.parse(localStorage.getItem('user_'+user));
    userData.history.push({role, content});
    localStorage.setItem('user_'+user, JSON.stringify(userData));
}

showLogin();
</script>

</body>
</html>
